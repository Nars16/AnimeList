{% extends "layout.html" %}
{% block title %}Anime{% endblock %}
{% block stylesheet %}
<link rel="stylesheet" href="/static/topanime.css">
{% endblock %}

{% block content %}

<h1>Top Anime</h1>

<div class="grid-container">
    <!-- Previous and next page buttons -->
    <div style="display: flex">
        <div style="align-self: flex-end">
            {% if show_prev %}
            <a class="enabled" href="{{prev_url}}">Previous page</a>
            {% else %}
            <a class="disabled">Previous page</a>
            {% endif %}

            {% if show_next %}
            <a class="enabled" href="{{next_url}}">Next page</a>
            {% else %}
            <a class="disabled">Next page</a>
            {% endif %}
        </div>
    </div>

    <!-- Search options -->
    <div>
        <form>
            <input type="hidden" value="{{'' if show else 'True'}}" name="show" />

            <!-- Search options hidden -->
            {% if not show %}
            <input type="hidden" value="{{tag}}" name="tag" />
            <input type="hidden" value="{{query}}" name="query" />
            <input type="hidden" value="{{related}}" name="related" />
            <div style="float: right">
                {% if tag or related or query %}
                <button type="reset">
                    <a class="enabled" href="/topanime">Clear</a>
                </button>
                {% else %}
                <button type="reset" disabled>
                    <a class="disabled">Clear</a>
                </button>
                {% endif %}
                <input type="submit" value="Show search options" />
            </div>

            <!-- Search options visible -->
            {% else %}
            <table>
                <tbody>
                    {% if show %}
                    <tr>
                        <td></td>
                        <td><a href="/tags">List of tags</a></td>
                    </tr>
                    <tr>
                        <td>Tag:</td>
                        <td>
                            <input {% if related %} disabled {% endif %} type="text" value="{{tag}}" name="tag"
                                placeholder="Tag" />
                        </td>
                    </tr>
                    <tr>
                        <td>Search:</td>
                        <td>
                            <input {% if related %} disabled {% endif %} type="text" value="{{query}}" name="query"
                                placeholder="Search" />
                        </td>
                    </tr>
                    {% if session.user_id %}
                    <tr>
                        <td>Related:</td>
                        <td>
                            <input {% if tag or query %} disabled {% endif %} type="checkbox" name="related" {% if
                                related %} checked {% endif %} />
                        </td>
                    </tr>
                    {% endif %}
                    {% endif %}
                    <tr>
                        <td width="30%">
                            {% if tag or related or query %}
                            <button type="reset">
                                <a class="enabled" href="/topanime?show=True">Clear</a>
                            </button>
                            {% else %}
                            <button type="reset" disabled>
                                <a class="disabled">Clear</a>
                            </button>
                            {% endif %}
                        </td>
                        <td>
                            {% if show %}
                            <input type="submit" value="Submit" />
                            {% else %}
                            <input type="submit" value="Show search options" />
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
            {% endif %}
        </form>
    </div>
</div>

<!-- Anime -->
{% if top_anime %}
<table>
    <thead>
        <tr>
            <th class="a"></th>
            <th class="b">Title</th>
            <th class="c">Score</th>
            <th class="d">Status</th>
        </tr>
    </thead>
    <tbody>
        {% for anime in top_anime %}
        <tr>
            <td class="a">
                {% if anime.thumbnail %}
                <img src="{{anime.thumbnail}}" width=50 height=70>
                {% else %}
                <img src="https://cdn.myanimelist.net/images/qm_50.gif" width=50 height=70>
                {% endif %}
            </td>
            <td class="b">
                <div>
                    <a href="/anime/{{anime.id}}">{{anime.title}}</a>
                    <br>
                    Episodes: {{anime.episodes}}
                </div>
            </td>
            <td class="c">
                {% if anime.score %}{{anime.score}}{% endif %}
            </td>
            <td class="d">
                <!-- List status -->
                {% if session.user_id %}
                {% if anime.id not in list_ids %}
                <form action="{{current_url}}" method="POST">
                    <input type="hidden" value="{{anime.id}}" name="anime_id" />
                    <input type="hidden" name="csrf_token" value="{{session.csrf_token}}" />
                    <input type="submit" value="Add to list">
                </form>
                {% else %}
                In list
                {% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p><strong>No anime found</strong></p>
{% endif %}

<!-- Previous and next page buttons -->
{% if top_anime %}
<div style="margin-top: 5px">
    {% if show_prev %}
    <a class="enabled" href="{{prev_url}}">Previous page</a>
    {% else %}
    <a class="disabled">Previous page</a>
    {% endif %}

    {% if show_next %}
    <a class="enabled" href="{{next_url}}">Next page</a>
    {% else %}
    <a class="disabled">Next page</a>
    {% endif %}
</div>
{% endif %}

{% endblock %}